name: Sync master to master-jdk21 using GitHub CLI

on:
  push:
    branches:
      - master

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout the repo
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Check for differences
        id: diffcheck
        run: |
          git fetch origin master-jdk21
          if git diff --quiet origin/master-jdk21..origin/master; then
            echo "No changes to sync"
            echo "sync_required=false" >> $GITHUB_OUTPUT
          else
            echo "Changes detected"
            echo "sync_required=true" >> $GITHUB_OUTPUT
          fi

      - name: Create PR using GitHub CLI
        if: steps.diffcheck.outputs.sync_required == 'true'
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          gh pr create \
            --head master \
            --base master-jdk21 \
            --title "Sync: master to master-jdk21" \
            --body "This is an automated PR to sync the latest changes from master into master-jdk21."
